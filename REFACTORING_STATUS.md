# –°—Ç–∞—Ç—É—Å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–µ–∫—Ç–∞

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤—Ä–µ–º–µ–Ω–µ–º (UTC+5, –¢—é–º–µ–Ω—å)
- **–§–∞–π–ª**: `utils/timezone.py`
- **–§—É–Ω–∫—Ü–∏–∏**:
  - `now_tyumen()` - —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ –¢—é–º–µ–Ω–∏
  - `iso_now()` - —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ ISO —Ñ–æ—Ä–º–∞—Ç–µ
  - `format_datetime()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  - `to_tyumen()` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –¢—é–º–µ–Ω–∏
  - `parse_iso()` - –ø–∞—Ä—Å–∏–Ω–≥ ISO —Å—Ç—Ä–æ–∫

### 2. Repository —Å–ª–æ–π (Data Access Layer)
- **–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å**: `repositories/base_repository.py`
  - –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Redis
  - –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON –æ–±—ä–µ–∫—Ç–∞–º–∏, —Å–ø–∏—Å–∫–∞–º–∏, –º–Ω–æ–∂–µ—Å—Ç–≤–∞–º–∏
  
- **TrackRepository**: `repositories/track_repository.py`
  - –†–∞–±–æ—Ç–∞ —Å —Ç—Ä–µ–∫–∞–º–∏ –≤ –∫–æ–º–Ω–∞—Ç–∞—Ö
  - –†–∞–±–æ—Ç–∞ —Å —Ç—Ä–µ–∫–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - –ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–æ–≤ –ø–æ —Ö–µ—à—É –∏ –Ω–∞–∑–≤–∞–Ω–∏—é
  
- **RoomRepository**: `repositories/room_repository.py`
  - –†–∞–±–æ—Ç–∞ —Å –∫–æ–º–Ω–∞—Ç–∞–º–∏
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏, –∞–¥–º–∏–Ω–∞–º–∏, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–Ω–∞—Ç (–º–æ–¥–µ—Ä–∞—Ü–∏—è)
  
- **ModerationRepository**: `repositories/moderation_repository.py`
  - –û—á–µ—Ä–µ–¥—å –º–æ–¥–µ—Ä–∞—Ü–∏–∏
  - –û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∏
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–æ–∑–≤—Ä–∞—Ç –≤ pending –ø—Ä–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (5 –º–∏–Ω—É—Ç)

### 3. Service —Å–ª–æ–π (Business Logic Layer)
- **TrackService**: `services/track_service.py`
  - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–æ–≤ –≤ –∫–æ–º–Ω–∞—Ç—ã
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ —Ç—Ä–µ–∫–æ–≤
  - –í–∞–ª–∏–¥–∞—Ü–∏—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
  
- **ModerationService**: `services/moderation_service.py`
  - –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
  - –û–¥–æ–±—Ä–µ–Ω–∏–µ/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ç—Ä–µ–∫–æ–≤
  - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤
  
- **RoomService**: `services/room_service.py`
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - –†–∞–±–æ—Ç–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∫–æ–º–Ω–∞—Ç
  
- **NotificationService**: `services/notification_service.py`
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞–º
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –∫–æ–º–Ω–∞—Ç—ã

### 4. –ß–∞—Å—Ç–∏—á–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ handlers
- **handlers/tracks.py**: 
  - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
  - ‚úÖ –§—É–Ω–∫—Ü–∏—è `confirm_track` —á–∞—Å—Ç–∏—á–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
  - ‚ö†Ô∏è –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

## ‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ handlers –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
**–§–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
- `handlers/tracks.py` - —á–∞—Å—Ç–∏—á–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω
- `handlers/rooms.py` - —Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `handlers/room_management.py` - —Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**
1. –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ `datetime.now().isoformat()` –Ω–∞ `iso_now()` –∏–∑ `utils.timezone`
2. –ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä—è–º—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ Redis –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
3. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ —Å–µ—Ä–≤–∏—Å—ã
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `NotificationService` –¥–ª—è –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 2. –£–ª—É—á—à–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –Ω—É–∂–Ω–æ–µ –º–µ–Ω—é
- –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–≤–µ—Ä—à–∏–ª
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–º–µ—Ä—ã:**
- –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–∞ ‚Üí –æ—Ç–∫—Ä—ã—Ç—å –∫–æ–º–Ω–∞—Ç—É —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Å–ø–∏—Å–∫–æ–º
- –ü–æ—Å–ª–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫ –≤ –æ—á–µ—Ä–µ–¥–∏
- –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ ‚Üí –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É —Ç—Ä–µ–∫–∞ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

## üìã TODO

### 1. –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ handlers
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `handlers/rooms.py`:
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `TrackRepository` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç—Ä–µ–∫–æ–≤
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `RoomRepository` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–º–Ω–∞—Ç–µ
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `format_datetime` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞—Ç
  
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `handlers/room_management.py`:
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ModerationService` –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `NotificationService` –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `format_datetime` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞—Ç

- [ ] –û–±–Ω–æ–≤–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `handlers/tracks.py`:
  - `approve_track` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ModerationService`
  - `reject_track` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ModerationService`
  - `my_tracks` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `TrackRepository`

### 2. –î–æ–±–∞–≤–∏—Ç—å DTO (Data Transfer Objects)
–°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å—ã –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–ª–æ—è–º–∏:
- `TrackDTO` - –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∞
- `RoomDTO` - –¥–∞–Ω–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã
- `ModerationDTO` - –¥–∞–Ω–Ω—ã–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏

### 3. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### 4. –î–æ–±–∞–≤–∏—Ç—å unit —Ç–µ—Å—Ç—ã
- –¢–µ—Å—Ç—ã –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- –¢–µ—Å—Ç—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤
- –¢–µ—Å—Ç—ã –¥–ª—è handlers

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
handlers/          # Presentation Layer (HTTP/Telegram handlers)
  ‚îú‚îÄ‚îÄ tracks.py
  ‚îú‚îÄ‚îÄ rooms.py
  ‚îî‚îÄ‚îÄ room_management.py

services/          # Business Logic Layer
  ‚îú‚îÄ‚îÄ track_service.py
  ‚îú‚îÄ‚îÄ moderation_service.py
  ‚îú‚îÄ‚îÄ room_service.py
  ‚îî‚îÄ‚îÄ notification_service.py

repositories/      # Data Access Layer
  ‚îú‚îÄ‚îÄ base_repository.py
  ‚îú‚îÄ‚îÄ track_repository.py
  ‚îú‚îÄ‚îÄ room_repository.py
  ‚îî‚îÄ‚îÄ moderation_repository.py

utils/             # Utilities
  ‚îú‚îÄ‚îÄ timezone.py
  ‚îú‚îÄ‚îÄ room_permissions.py
  ‚îî‚îÄ‚îÄ ...
```

## üìù –ü—Ä–∏–Ω—Ü–∏–ø—ã SOLID

### Single Responsibility Principle (SRP)
- ‚úÖ –ö–∞–∂–¥—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ä–∞–±–æ—Ç—É —Å –æ–¥–Ω–∏–º —Ç–∏–ø–æ–º –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É –±–∏–∑–Ω–µ—Å-–æ–±–ª–∞—Å—Ç—å
- ‚ö†Ô∏è Handlers –µ—â–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)

### Open/Closed Principle (OCP)
- ‚úÖ –ë–∞–∑–æ–≤—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞—Å—à–∏—Ä—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –°–µ—Ä–≤–∏—Å—ã –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

### Liskov Substitution Principle (LSP)
- ‚úÖ –í—Å–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç BaseRepository –∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º–æ

### Interface Segregation Principle (ISP)
- ‚úÖ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–µ—Ç–æ–¥—ã
- ‚úÖ –°–µ—Ä–≤–∏—Å—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### Dependency Inversion Principle (DIP)
- ‚úÖ Handlers –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π (—Å–µ—Ä–≤–∏—Å–æ–≤), –∞ –Ω–µ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
- ‚úÖ –°–µ—Ä–≤–∏—Å—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ (–∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π)

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1**: –ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ handlers –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
2. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2**: –£–ª—É—á—à–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é - –≤–æ–∑–≤—Ä–∞—Ç –≤ –Ω—É–∂–Ω–æ–µ –º–µ–Ω—é –ø–æ—Å–ª–µ –¥–µ–π—Å—Ç–≤–∏–π
3. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3**: –î–æ–±–∞–≤–∏—Ç—å DTO –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö
4. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4**: –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
