# CI/CD Workflows

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç GitHub Actions workflows –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ CI/CD –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–æ–µ–∫—Ç–∞ PlayRoom.

## Workflows

### 1. `ci.yml` - Continuous Integration

–û—Å–Ω–æ–≤–Ω–æ–π CI workflow, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –∏ pull request.

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ Python
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤
- ‚úÖ –õ–∏–Ω—Ç–∏–Ω–≥ —Å flake8 (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏ —Å—Ç–∏–ª—å)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ (black)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏–º–ø–æ—Ä—Ç–æ–≤ (isort)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (safety)
- ‚úÖ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–æ—Ç–∞

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ –≤–µ—Ç–∫–∏: `main`, `develop`, `master`
- Pull requests –≤ —ç—Ç–∏ –≤–µ—Ç–∫–∏
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ `workflow_dispatch`

### 2. `deploy.yml` - Deployment

Workflow –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

**–§—É–Ω–∫—Ü–∏–∏:**
- üì¶ –°–æ–∑–¥–∞–Ω–∏–µ deployment –ø–∞–∫–µ—Ç–∞
- üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞ –¥–ª—è –¥–µ–ø–ª–æ—è
- üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ –≤–µ—Ç–∫—É `main` –∏–ª–∏ `master`
- Push —Ç–µ–≥–æ–≤ `v*`
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Å –≤—ã–±–æ—Ä–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
1. –°–∫–∞—á–∞–π—Ç–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç `bot-deployment` –∏–∑ workflow run
2. –†–∞—Å–ø–∞–∫—É–π—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `tar -xzf bot.tar.gz`
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `pip install -r requirements.txt`
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `./start_bot.sh`

### 3. `dependency-review.yml` - Dependency Review

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ pull requests.

**–§—É–Ω–∫—Ü–∏–∏:**
- üîç –ê–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö
- üîí –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Pull requests –≤ –≤–µ—Ç–∫–∏: `main`, `develop`, `master`

## –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫ –ª–æ–∫–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```bash
./ci_check.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–µ –∂–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –∏ CI pipeline.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–ª—è —Ä–∞–±–æ—Ç—ã CI/CD –º–æ–≥—É—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ Settings ‚Üí Secrets):

- `API_TOKEN` - —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)
- `REDIS_HOST` - —Ö–æ—Å—Ç Redis (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é localhost)
- `REDIS_PORT` - –ø–æ—Ä—Ç Redis (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 6379)

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

CI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ pip –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏. –ö—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `requirements.txt`.

## –°—Ç–∞—Ç—É—Å –±–µ–π–¥–∂–µ–π

–î–æ–±–∞–≤—å—Ç–µ –≤ README.md –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ CI:

```markdown
![CI](https://github.com/your-username/playroom/workflows/CI/badge.svg)
```

## Troubleshooting

### CI –ø–∞–¥–∞–µ—Ç –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ –∏–º–ø–æ—Ä—Ç–æ–≤

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
```bash
pip install -r requirements.txt
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å Redis –≤ CI

Redis –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∫ service –≤ GitHub Actions. –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –í–µ—Ä—Å–∏—é –æ–±—Ä–∞–∑–∞ Redis –≤ `ci.yml`
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Ä—Ç–æ–≤
- Health check –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

–ò—Å–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
```bash
black .
isort .
```
